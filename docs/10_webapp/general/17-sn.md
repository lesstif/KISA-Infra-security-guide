# SN: 17. 데이터 평문 전송

**분류**: Web Application(웹)

**중요도**: 상

---

!!! info "참고"
    우회 방안 예시

§ 인코딩 적용 : 필터링 시스템이 특정 문자열 패턴을 차단하는 경우 문자열을 인코딩하여 우회 시도 인코딩 방식 사용 예시 16bit 유니코드 인코딩 .(%u002e), /(%u2215), \(%u2216) URL 인코딩 .(%2e), /(%2f), \(%5c) 더블 URL 인코딩 .(%252e), /(%252f), \(%255c) Base64인코딩 ../../etc/passwd (Li4vLi4vZXRjL3Bhc3N3ZA==) HTML 엔티티 인코딩 ..&#x2F;..&#x2F;etc&#x2F;passwd § 특수문자 중첩 사용 : 필터링 시스템이 단일 패턴(../)을 감지하여 소거할 경우, 중복된 경로 문자를 사용하여 우회( ....// → ../ ) § 종단 문자 추가 : 필터링 시스템이 특정 확장자만 허용할 때 Nullbyte, 개행 문자 등을 사용하여 우회([파일 명]%00.jpg , [파일명]%0a.jpg 등) § 문자열 패턴 검증 우회 : 시스템 파일 관련 단어(etc, passwd 등)들을 필터링할 때 대소문자 변환(EtC, PaSswD 등), URL인코딩과 조합(e%74c%2Fpa%73%73wd) 등의 방법을 사용하여 우회

**조치 방법**

1. 파일 다운로드의 취약점은 주로 파일 이름 조작으로 인해 발생되므로 파일의 이름을 데이터베이스에

저장하고 다운로드 수행 시 요청 파일 이름과 비교하여 적절한지 확인하여 사용자가 조작할 수 있는 공격 포인트를 제거

2. 파일 다운로드가 가능한 디렉터리를 별도의 파티션에서 관리하거나 특정 디렉터리로 한정하여 다른

디렉터리에서는 파일을 다운받을 수 없도록 설정

3. URL을 통해 파일 경로를 직접 노출시키지 않고, 파일 ID나 토큰을 사용하여 파일 경로를 은닉

4. 공격자가 입력값 변조를 통한 경로 추적이 불가하도록 파일 확장자 등의 일부 패턴을 화이트리스트로

적용하여 검증하고, 경로 추적 관련 특수문자(. / \ % 등) 필터링 로직 구현

!!! info "Java"

특수문자 필터링을 통한 입력값 검증 로직 예시 public class FileDownloadUtil { //파일 이름에 영문,숫자,일부 특수문자를 제외한 \,/ 문자 등이 탐지되었을 때 다운로드 차단 public static boolean isValidFileName(String fileName) { return fileName != null && fileName.matches("^[a-zA-Z0-9._-]+$"); } private static final Set<String> ALLOWED_EXTENSIONS; //허용 확장자 리스트 static { Set<String> tempSet = new HashSet<>(); tempSet.add("jpg"); tempSet.add("png"); ALLOWED_EXTENSIONS = Collections.unmodifiableSet(tempSet); } public static boolean isAllowedExtension(String filePath) { String extension = filePath.substring(filePath.lastIndexOf(".") + 1).toLowerCase(); // 파일 확장자 검증 return ALLOWED_EXTENSIONS.contains(extension); } } ... @GetMapping("/downloadFile") public ResponseEntity<Resource> downloadFile(@RequestParam String filename, HttpServletResponse response) throws IOException { if(!FileDownloadUtil.isValidFileName(filename) || !FileDownloadUtil.isAllowedExtension(filename)) { // 다운로드 컨트롤러에 검증 로직 적용 return ResponseEntity.badRequest().build(); } ...

