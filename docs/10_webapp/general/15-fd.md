# FD: 15. 파일 다운로드

**분류**: Web Application(웹)

**중요도**: 상

---

!!! info "ASP.NET"

§ 화이트리스트 방식의 확장자 검증 로직을 통한 허용된 확장자 파일만 업로드 파일 업로드 보안 코드 예시 ... private static readonly string[] AllowedExtensions = { ".jpg", ".jpeg", ".png", ".gif", ".pdf", ".txt" }; private static readonly string[] AllowedMime = { "image/jpeg","image/png","image/gif","application/pdf", "text/plain" }; ... // 파일명 정규화 private static string NormalizeFilename(string filename) { if (string.IsNullOrWhiteSpace(filename)) return string.Empty; string name = System.Web.HttpUtility.UrlDecode(filename, Encoding.UTF8); name = name.Normalize(NormalizationForm.FormC); name = name.Replace("\0", ""); name = Regex.Replace(name, "[<>:\"/\\\\|?*]", ""); name = Regex.Replace(name, "^[.\\s]+|[.\\s]+$", ""); return name; } // 확장자 검증 (이중 확장자 차단 포함) private static bool IsValidExtension(string filename) { string safeName = NormalizeFilename(filename); if (string.IsNullOrEmpty(safeName)) return false; // 이중 확장자 차단 if (safeName.Split('.').Length != 2) return false; string ext = Path.GetExtension(safeName).ToLowerInvariant(); return Array.Exists(AllowedExtensions, e => e == ext); } protected void btnUpload_Click(object sender, EventArgs e) { if (FileUpload1.HasFile) { string safeName = NormalizeFilename(FileUpload1.FileName); // 확장자 검증 if (!IsValidExtension(safeName)) { Response.Write("허용되지 않은 확장자입니다."); return; } // MIME 타입 검증 (주의: Web Forms의 ContentType은 신뢰성이 낮음) string mime = FileUpload1.PostedFile.ContentType.ToLowerInvariant(); if (Array.IndexOf(AllowedMime, mime) < 0) { Response.Write("허용되지 않은 MIME 타입입니다."); return; } // 난수화된 파일명 생성 string ext = Path.GetExtension(safeName).ToLowerInvariant(); string newName = Guid.NewGuid().ToString("N") + ext; // 저장 경로 (웹 루트 외부 권장) string uploadPath = Server.MapPath("~/Uploads/"); if (!Directory.Exists(uploadPath)) { Directory.CreateDirectory(uploadPath); } string savePath = Path.Combine(uploadPath, newName); try { FileUpload1.SaveAs(savePath); Response.Write("업로드 성공: " + HttpUtility.HtmlEncode(newName)); } catch (Exception ex) { Response.Write("업로드 실패: " + HttpUtility.HtmlEncode(ex.Message)); }

